# Lab-3-AK

## Язык программирования
***
* Алгоритмический язык программирования, синтаксис похож на синтаксис C.
* Каждое выражение должно заканчиваться space или enter. 
* Поддерживаются математические выражения.
* Стратегия вычисления: передача параметров через глобальную область видимости всех переменных
* Все переменные объявляются в глобальной зоне видимости 
Статическая типизация, существует 3 типа данных:
* целое число
* символ, в памяти хранится как число в кодировке ОС
* строка, ссылка на последовательность символов, первое из которых - число, означающее количество символов в строке

### BNF

```BNF
<program> ::= <statements> "};"
<statements> ::= <statements> <statement>
    | ""

statement : assignment
    | while
    | if
    | input
    | output

<NAME> ::= <small letter> <letters and digits> 

"""operation : NAME operand NAME
    | <NAME> operand NUMBER
    | NUMBER operand NAME
    | NUMBER operand NUMBER"""

"""operand : PLUS
    | MINUS
    | TIMES
    | DIVIDE
    | MOD"""

"""assignment : NAME EQUALS NUMBER
    | NAME EQUALS operation
    | NAME EQUALS NAME
    | NAME EQUALS STR
    | NAME EQUALS CHAR"""

"""while : WHILE LPAREN condition RPAREN LBRACE statements RBRACE"""

if : IF LPAREN condition RPAREN LBRACE statements RBRACE

"""condition : NAME comparison NUMBER
    | NUMBER comparison NAME
    | NUMBER comparison NUMBER
    | NAME comparison NAME"""

"""comparison : LESS
    | MORE
    | EQUAL
    | NOT_EQUAL
    | LESS_EQUAL
    | MORE_EQUAL"""

"""input : INPUTCHAR LPAREN NAME RPAREN
    | INPUT LPAREN NAME RPAREN
    | INPUTINT LPAREN NAME RPAREN"""

"""output : PRINT LPAREN NAME RPAREN
    | PRINTINT LPAREN NAME RPAREN
    | PRINTCHAR LPAREN NAME RPAREN"""
```
* Функции используются только встроенные:
*  read и print:
  * print:
    * Выводит результат математического выражения
    * Выводит переменную типа `string` как строку
    * Выводит данный символ
  * read:
    * Считывание одного символа в переменную типа `char`
    * Считывание строки не длинее, чем аргумент функции.
* Цикл `while` и условный переход `if` в качестве аргумента принимают `condition`
  * `condition` проверяет на равенство или неравенство два математических выражения, поддерживаемые сравнения:
    * `==, !=, >, <, <=, >=`
  * `break` или `else` не предусмотрены
* Поддерживаются математические выражения, поддерживаемые операции:
  * `+, -, *, /, %`
* Литералы:
  * Целые числа
  * Строки `"<string>"`
  * Символы `'<character>'`

## Организация памяти

Модель памяти: `neum` -  архитектура Фон Неймана
Инструкция занимает 3 ячейки памяти: 1 инструкция и 2 аргумента
Каждая ячейка памяти может хранить целое 64 битное число
Адресом является целое число
Программист может изменять любое значение ячейки памяти, в том числе аргумента команды, это можно использовать для реализации указателей

### Модель  памяти

| Address | Instruction      |
|---------|------------------|
| 0       | instruction/data |
| 1       | instruction/data |
| ...     |
| 2048    | instruction/data |

* ячейки `0-511` используются для команд и их аргументов
* ячейки `512-1023` используется для данных
* ячейки `1024-2048` используется для стека
Распределение памяти от 0-1023 не фиксировано и задается компилятором

Целочисленные переменные хранятся каждая в своей ячейке памяти
Символы
Строки

Так как инструкция занимает 3 ячейки, то счетчик комманд всегда переключается на 3 ячейки вперед, кроме команд ветвления.

### Pегистры

* Специализированные: `IP`, `SP`
* РОН нет, вместо них используется стек

## Система команд


| Операнд  | Описание                         | Аргумент1             | Аргумент2      | Аргумент2 | Кол-во тактов |
|----------|----------------------------------|-----------------------|----------------|-----------|---------------|
| `READ`   | Чтение символа                   | Регистр               | -              | -         | 3             |
| `PRINT`  | Вывод символа                    | Регистр/символ        | -              | -         | 3             |
 | `MOD`    | Нахождение остатка от деления    | Регистр/число         | Регистр/число  |           | 4             |
 | `ADD`    | Сложение                         | Регистр/число         | Регистр/число  | Регистр   | 4             |
 | `MUL`    | Умножение                        | Регистр/число         | Регистр/число  | Регистр   | 4             |
 | `DIV`    | Целочисленное деление            | Регистр/число         | Регистр/число  | Регистр   | 4             |
 | `INC`    | Инкремент                        | ячейка памяти | -              | -         | 6             |
 | `JMP`    | Безусловный переход              | Число                 | -              | -         | 2             |
 | `JE`     | Переход, если равно              | Число                 | -              | -         | 2             |
 | `JNG`    | Переход, если меньше или равно   | Число                 | -              | -         | 2             |
 | `JNL`    | Переход, если больше или равно   | Число                 | -              | -         | 2             |
 | `JG`     | Переход, если больше             | Число                 | -              | -         | 2             |
 | `JL`     | Переход, если меньше             | Число                 | -              | -         | 2             |
 | `JNE`    | Переход, если не равно          | Число                 | -              | -         | 2             |
 | `CMP`    | Установить флаги сравнения чисел | Регистр/число         | Регистр/число  | -         | 3             |
 | `ST`     | Загрузить в память               | Регистр/число         | Ячейка/регистр | -         | 4             |
| `LD`     | Загрузить в регистры             | Регистр/число/ячейка | Регистр        | -         | 3-4           |
| `PUSH`   | Загрузить в стек                 | Регистр/число         | -              | -         | 5             |
 | `POP`    | Выгрузить из стека               | Регистр               | -              | -         | 5             |
 | `HLT`    | Остановка                        | -                     | -              | -         | 3             |
 
### Кодирование инструкций

Программа загружается в машину из двоичного файла, в котором инструкции представлены также, как в памяти

## Транслятор 

Транслятор запускается командой python3 main.py, аргументы не требуются
Программа считывается из консоли
Скомпилированный машинный код в бинарном виде записывается в файл program.o


## Модель процессора

### Datapath
![image](https://github.com/Lisi4ka59/Lab-3-AK/assets/122356446/af28bc90-594c-4e8e-9915-d305d4cc21c0)

### Control Unit
![image](https://github.com/Lisi4ka59/Lab-3-AK/assets/122356446/22440f2f-90fd-47e4-9af2-665cbf90f59e)


## Тестирование

### Описание работы настроенного CI
Производится проверка форматироания и линтер, затем запускаются тесты, каждый из которых состоит из сборки программы из исходного кода, запуска машины и сверки результата работы машины с эталоном 







